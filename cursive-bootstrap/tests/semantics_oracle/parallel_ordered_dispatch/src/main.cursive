# SPEC_COV: Parallel-Ordered-Dispatch
# SPEC_COV: ยง18.5.2
# SPEC_COV: ยง18.8.1
// Tests determinism with [ordered] attribute (ยง18.5.2, ยง18.8.1)
// Side effects are buffered and applied in index order
// Output must be "0123456789" regardless of parallel execution

public procedure main(ctx: Context) -> i32 {
  let domain = ctx~>cpu()

  parallel domain {
    // [ordered] ensures side effects are applied in index order
    dispatch i in 0..10 [ordered] {
      let digit_view: string@View = match i {
        0usize => { "0" }
        1usize => { "1" }
        2usize => { "2" }
        3usize => { "3" }
        4usize => { "4" }
        5usize => { "5" }
        6usize => { "6" }
        7usize => { "7" }
        8usize => { "8" }
        9usize => { "9" }
        _ => { "" }
      }
      let _ = match ctx.fs~>write_stdout(digit_view) {
        ok: () => ()
        err: IoError => ()
      }
      ()
    }
  }

  return 0i32
}
