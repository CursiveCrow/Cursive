/// End-to-end test for nested procedure calls.
/// Tests that deeply nested calls work correctly.

procedure inc(x: i32) -> i32 {
  return x + 1
}

procedure double(x: i32) -> i32 {
  return x + x
}

procedure square(x: i32) -> i32 {
  return x * x
}

procedure chain(x: i32) -> i32 {
  // inc(double(x)) = inc(x + x) = x + x + 1
  var doubled: i32 = double(x)
  return inc(doubled)
}

procedure deep_chain(x: i32) -> i32 {
  // square(chain(x)) = square(x + x + 1) = (x + x + 1)^2
  var chained: i32 = chain(x)
  return square(chained)
}

public procedure main(ctx: Context) -> i32 {
  var a: i32 = 3
  
  // deep_chain(3) = square(chain(3))
  //               = square(inc(double(3)))
  //               = square(inc(6))
  //               = square(7)
  //               = 49
  return deep_chain(a)
}
