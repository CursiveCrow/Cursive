// RUN: run-pass
// EXIT: 11
// SPEC: 5.8, 12.4
// DESC: Managed string type creation and operations

procedure create_managed(heap: $HeapAllocator) -> string@Managed | AllocationError {
    let view: string@View = "hello world"
    return string::from(view, heap)
}

procedure get_length(s: const string@Managed) -> usize {
    let view: string@View = string::as_view(s)
    return string::length(view)
}

public procedure main(move ctx: Context) -> i32 {
    let result: string@Managed | AllocationError = create_managed(ctx.heap)
    let len: i32 = match result {
        s: string@Managed => {
            let l: usize = get_length(s)
            l as i32
        }
        e: AllocationError => { 0 }
    }
    return len
}
