// RUN: run-fail
// EXIT: 134
// SPEC: 7.4 Cleanup-Step-Drop-Panic
// DESC: When drop panics during cleanup, process aborts (double-panic)

record PanicOnDrop {
    value: i32
    procedure drop(~!) -> () {
        panic("drop panic")
    }
}

public procedure main(move ctx: Context) -> i32 {
    {
        let p: PanicOnDrop = PanicOnDrop { value: 42 }
        panic("initial panic")
    }
    return 0
}
