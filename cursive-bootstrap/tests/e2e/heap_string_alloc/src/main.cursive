# SPEC_COV: Prim-String-From
# SPEC_COV: Prim-String-Drop
# SPEC_COV: HeapAllocator-Alloc
# Tests heap-allocated string lifecycle: allocation, use, and automatic deallocation.
public procedure main(ctx: Context) -> i32 {
  let view: string@View = "hello world";
  let view_len = string::length(view);
  let managed_res = string::from(view, ctx.heap);
  let msg: string@View = match move managed_res {
    s: string@Managed => {
      let s_view = string::as_view(s);
      let len = string::length(s_view);
      if view_len != 11usize {
        "view_bad"
      } else if len == 0usize {
        "len0"
      } else if len == 11usize {
        "ok"
      } else if len == 12usize {
        "len12"
      } else {
        "len_other"
      }
    },
    err: AllocationError => "alloc_err"
  };
  let _ = match ctx.fs~>write_stdout(msg) {
    ok: () => (),
    err: IoError => ()
  };
  return 0i32;
}
