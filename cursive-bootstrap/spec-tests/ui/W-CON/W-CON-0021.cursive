// RUN: compile-pass
// DIAG: W-CON-0021
// SPEC: 14.4.5
// DESC: Speculative block body may be expensive to re-execute

record LargeData {
    values: [i32; 100]
}

procedure expensive_compute(data: const LargeData) -> i32 {
    var sum: i32 = 0
    var i: usize = 0
    loop i < 100 {
        sum = sum + data.values[i]
        i = i + 1
    }
    return sum
}

public procedure main(move ctx: Context) -> i32 {
    var x: shared i32 = 0
    let data: LargeData = LargeData{ values: [1; 100] }
    #x speculative write { //~ WARN W-CON-0021: expensive to re-execute
        let result = expensive_compute(data)
        x = result
    }
    return 0
}
